import { NextResponse } from "next/server"; import { supabaseAdmin } from "@/lib/supabaseAdmin"; export async function GET(req:Request){ const {searchParams}=new URL(req.url); const key=searchParams.get("key"); const order_id=Number(searchParams.get("order_id")||0); if(!order_id) return NextResponse.json({error:"order_id gerekli"},{status:400}); const ok=key===process.env.ADMIN_SECRET||key===process.env.PRODUCTION_SECRET; if(!ok) return NextResponse.json({error:"Yetkisiz"},{status:401}); const {data,error}=await supabaseAdmin.from("messages").select("*").eq("order_id",order_id).order("id",{ascending:true}); if(error) return NextResponse.json({error:error.message},{status:500}); return NextResponse.json({messages:data}); } export async function POST(req:Request){ const {searchParams}=new URL(req.url); const key=searchParams.get("key"); const ok=key===process.env.ADMIN_SECRET||key===process.env.PRODUCTION_SECRET; if(!ok) return NextResponse.json({error:"Yetkisiz"},{status:401}); const body=await req.json(); const {order_id,sender,content}=body; if(!order_id||!sender||!content) return NextResponse.json({error:"Eksik parametre"},{status:400}); const {error}=await supabaseAdmin.from("messages").insert({order_id,sender,content}); if(error) return NextResponse.json({error:error.message},{status:500}); return NextResponse.json({ok:true}); }