import { NextResponse } from "next/server"; import { supabaseAdmin } from "@/lib/supabaseAdmin"; export async function GET(req:Request){ const {searchParams}=new URL(req.url); const key=searchParams.get("key"); if(key!==process.env.ADMIN_SECRET) return NextResponse.json({error:"Yetkisiz"},{status:401}); const {data:orders,error}=await supabaseAdmin.from("orders").select("*").order("id",{ascending:false}); if(error) return NextResponse.json({error:error.message},{status:500}); const {data:items,error:itemsErr}=await supabaseAdmin.from("order_items").select("*, products:product_id(name)").order("id",{ascending:true}); if(itemsErr) return NextResponse.json({error:itemsErr.message},{status:500}); return NextResponse.json({orders,items}); }