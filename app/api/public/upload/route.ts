import { NextResponse } from "next/server"; import { supabaseAdmin } from "@/lib/supabaseAdmin"; export const runtime="nodejs"; export async function POST(req:Request){ const form=await req.formData(); const file=form.get("file") as File|null; if(!file) return NextResponse.json({error:"Dosya yok"},{status:400}); const ext=file.name.split(".").pop()||"bin"; const path=`uploads/${Date.now()}-${Math.random().toString(36).slice(2)}.${ext}`; const buf=Buffer.from(await file.arrayBuffer()); const {error}=await supabaseAdmin.storage.from("uploads").upload(path, buf, {contentType:file.type||"application/octet-stream",upsert:false}); if(error) return NextResponse.json({error:error.message},{status:500}); const {data}=supabaseAdmin.storage.from("uploads").getPublicUrl(path); return NextResponse.json({url:data.publicUrl}); }